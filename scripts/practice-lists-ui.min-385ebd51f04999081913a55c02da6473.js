function h(a,b){var c;for(a&&a.correspondingUseElement&&(a=a.correspondingUseElement);a&&a.getAttribute;){if(c=a.getAttribute(b))return c;a=a.parentNode}return null}function k(a){var b=arguments,c,e;var f=1;for(e=b.length;f<e;f+=2){var d=b[f].split(/\s/);for(c=d.length;c--;)b[0].addEventListener(d[c],b[f+1])}}function m(a){return function(b){b.stopPropagation();b.preventDefault();!0!==b.g&&(a(b),b.g=!0)}}
function n(a){var b,c=[];for(b in a)c[c.length]=encodeURIComponent(b)+"="+encodeURIComponent(a[b]);return c.join("&").replace("%20","+")}function q(a,b,c,e){var f=r,d=new XMLHttpRequest,g=null;d.open(a,b,!0);d.onreadystatechange=function(){if(4==d.readyState)if(200<=d.status&&300>d.status){var l=JSON.parse(d.responseText);e(l)}else f(d.responseText)};c&&(g=n(c),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"));d.send(g)}var u=null,v=null,w="",x=null;
function y(){if(u){u.classList.remove(w);u.removeEventListener(window.PointerEvent?"pointerdown":"click",y);for(var a=window,b=z,c="mousedown".split(/\s/),e=c.length;e--;)a.removeEventListener(c[e],b,!1);u=null;x&&(x(),x=null)}}function z(a){for(a=a.target;a;){if(a==u||a==v)return;a=a.parentNode}y()}function A(a,b,c,e){k(a,"mousedown touchstart",m(function(){b.classList.contains("active")?y():(y(),b.classList.add("active"),u=b,w="active",x=e,c&&c(),k(window,"mousedown",z),v=a)}))};function r(){}function B(a,b){b&&a.getAttribute("user")&&q("GET",`/api/v1/slices/${b}/practice-lists/`,null,c=>{a.sliceData=c})}function C(a){var b=a.h,c=a.inLibrary;c?b.classList.add("in-library"):b.classList.remove("in-library");c?b.classList.remove("not-in-library"):b.classList.add("not-in-library");a.g?b.classList.add("in-a-list"):b.classList.remove("in-a-list");a.dispatchEvent(new Event("library_updated"))}
class D extends HTMLElement{static get observedAttributes(){return["slice"]}constructor(){super();this.j="";this.g=0;this.i={};this.l=!1;this.appendChild(document.getElementById("slice-practice-lists").content.cloneNode(!0));this.h=this.firstElementChild.querySelectorAll(".slice-practice-lists-button")[0];k(this.querySelectorAll(".practice-list-create-list-button")[0],"click",a=>{window.soundslice.isNonfree||(a.preventDefault(),window.soundslice.openUpgradeModal("Creating custom lists"))})}attributeChangedCallback(a,
b,c){"slice"===a&&c&&c!==b&&"1"!==this.getAttribute("lazy")&&B(this,c)}set sliceData(a){if(!this.isInitialized&&(this.j=this.getAttribute("slice"),this.getAttribute("user"))){var b=this.firstElementChild.querySelectorAll(".ui-tooltip")[0],c=b.querySelectorAll(".practice-list-content")[0];this.g=a.in_count;this.i=a.lists;this.l=a.is_owner_or_student;c.innerHTML=a.html;C(this);a=c.querySelectorAll("input");for(c=a.length;c--;)k(a[c],"change",e=>{var f=e.target,d=h(f,"data-listhash"),g="1"===h(f,"data-editable");
f=!this.i[d];if(d)if(g){e=this.j;g=this.firstElementChild.querySelectorAll(`.pl_div${d}`)[0];var l=g.querySelectorAll(".slicecount")[0],t=g.querySelectorAll(".praclink")[0],p=parseInt(l.innerText,10);f?(this.g++,p++,q("POST",`/api/v1/practice-lists/${d}/slices/`,{slicehashes:e},r)):(this.g--,p--,q("DELETE",`/api/v1/practice-lists/${d}/slices/${e}/`,null,r));this.i[d]=f;C(this);t.setAttribute("href",f?t.getAttribute("data-inlist-url"):t.getAttribute("data-notinlist-url"));l.textContent=p;g.querySelectorAll(".sliceplural")[0].textContent=
1===p?"slice":"slices"}else e.target.checked=!e.target.checked,window.soundslice.openUpgradeModal("Using custom lists")});A(this.h,b,()=>{this.h.classList.add("active")},()=>{this.h.classList.remove("active")})}}get isInitialized(){return""!==this.j}get inLibrary(){return this.l||!!this.g}}customElements.define("slice-practice-lists",D);
