(function(e,l,D,y,n,p,E,z,u,F,G,H,v,A,I,M){function r(a){for(var b=document.querySelectorAll(".modal.active"),g=b.length;g--;)a&&y(b[g],"jsnoescape")||F(b[g]);D("BLUR_ALL")}function J(a){a.preventDefault();r(!1)}function w(a){a=a.getElementsByClassName("jsclosemodal");for(var b=a.length;b--;)l(a[b],"click",J)}function B(a){var b=A(a.target,"data-modal");b&&(a.preventDefault(),t(b,A(a.target,"data-modal-extra")||"",null,null))}function t(a,b,g,c){var h=a+"-modal";if(!b&&e(h))u(h),c&&c();else{a="/modals/"+
a+"/";var k=e(h);k&&k.parentNode.removeChild(k);b&&(a+="?data="+encodeURIComponent(b));v("GET",a,null,f=>{document.body.insertAdjacentHTML("beforeend",f.modal);w(e(h));u(h);g&&g();c&&c()},()=>{})}}function C(a){e("page-message-txt").innerText=a;n(e("page-message"),"active")}function x(a,b){a=a.value.trim();""!==a&&(window.location=(b===q.PERSONAL?"/manage/":"/search/")+"?q="+encodeURIComponent(a))}function K(a,b,g){a.value===b&&v("GET",`/manage/search-completions/?q=${b}`,null,g,()=>{})}function L(a){var b=
e("globalsearchdropdown"),g=[],c=-1,h=null,k=!1;b.innerHTML="";l(e("globalsearchform"),"submit",f=>{f.preventDefault();x(a,k?q.PERSONAL:q.COMMUNITY)});l(a,"input focus",f=>{var m=f.currentTarget.value.trim();E(b,"active",""!==m);m&&m===f.currentTarget.value&&(clearTimeout(h),h=setTimeout(K,200,a,m,d=>{a.value===d.q&&(k=d.has_personal,b.innerHTML=d.html,g=b.querySelectorAll(".autocomplete-dropdown-item"),c=-1)}))},"blur",()=>{p(b,"active")},"keydown",f=>{var m=f.which,d=-1===c?null:g[c];13===m?(f.preventDefault(),
-1===c?x(a,k?q.PERSONAL:q.COMMUNITY):d&&d.href?window.location=d.href:(a.value=d.innerText,x(a,q.PERSONAL))):27===m?a.blur():32===m?d&&!d.href&&(a.value=d.innerText):40===m?(f.preventDefault(),f=g.length-1,-1!==c&&c!==f&&p(g[c],"active"),c<f&&(c+=1,n(g[c],"active"))):38===m&&(f.preventDefault(),-1!==c&&0<c&&p(g[c],"active"),0<c&&(--c,n(g[c],"active")))});l(b,"mousedown",f=>{if(f=I(f.target,"href"))window.location=f.href})}const q={PERSONAL:1,COMMUNITY:2};window.soundslice.activateModalOpeners=function(){for(var a=
document.getElementsByClassName("jsopenmodal"),b=a.length;b--;)l(a[b],"click",B)};window.soundslice.modalOpenerClick=B;window.soundslice.activateModalClosers=w;window.soundslice.closeActiveModal=r;window.soundslice.loadAjaxModal=t;window.soundslice.openUpgradeModal=function(a){t("upgrade","",null,()=>{e("upgrade-modal-feature").innerText=a})};window.soundslice.showSuccessMessage=C;G(function(){var a=e("searchwrap"),b=e("searchlink"),g=e("page-message"),c,h;var k=document.getElementsByClassName("showloginmodal");
for(h=k.length;h--;)l(k[h],"click",function(d){d.preventDefault();u("loginmodal");setTimeout(function(){e("loginmodal_email").focus()},100)});b&&a&&l(b,"mousedown touchstart",function(d){d.preventDefault();z(a,"active");e("searchbar").focus()});(c=e("settings-link"))&&H(c,e("user-settings"),"active");k=document.getElementsByClassName("feedback-modal-button");for(h=k.length;h--;)l(k[h],"click",()=>{t("feedback","",()=>{l(e("feedback-form"),"submit",d=>{d.preventDefault();(d=d.target.feedback.value.trim())&&
v("POST","/api/v1/feedback/",{message:d},N=>{C("Thanks for the feedback!");r(!1)},()=>{})})},null)});(c=e("close-page-message"))&&l(c,"mousedown touchstart",function(d){p(g,"active")});g&&y(g,"active")&&setTimeout(function(){p(g,"active")},4E3);(c=e("globalsearch"))&&L(c);c=document.getElementsByClassName("header-search")[0];b=e("show-search-mobile");c&&b&&(l(b,"click",()=>{n(document.body,"mobile-search-on");c.focus()}),l(e("globalsearchcancel"),"click",()=>{p(document.body,"mobile-search-on")}));
k=document.getElementsByClassName("mobile-menu-toggle");for(h=k.length;h--;)l(k[h],"mousedown",function(){z(document.body,"mobile-menu-on")});w(document);l(window,"keydown",function(d){27===d.which&&r(!0)});"serviceWorker"in navigator&&navigator.serviceWorker.register("/serviceworker.js",{scope:"/"});var f=null,m=e("has-beforeinstallprompt");m&&(window.addEventListener("beforeinstallprompt",d=>{f=d;n(e("no-beforeinstallprompt"),"hidden-i");p(m,"hidden-i")}),window.addEventListener("appinstalled",
()=>{n(e("no-beforeinstallprompt"),"hidden-i");n(m,"hidden-i")}),l(m,"click",()=>{f&&(f.prompt(),f=null)}))})})(utils.gid,utils.assign,utils.dispatch,utils.hasClass,utils.addClass,utils.removeClass,utils.addRemoveClass,utils.toggleClass,utils.openModal,utils.closeModal,utils.onready,utils.makeMenu,utils.ajax,utils.getDataAttribute,utils.getElementWithAttribute,utils.makeSafe);
